#!/usr/bin/env bash
# Post-push hook: runs integration tests after push
# This ensures code quality without the complexity of automatic PR creation

set -euo pipefail

# Source common functions
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/../common.sh"

log INFO "Post-push: running integration tests..."

# Run integration tests to ensure code quality
if ! .venv/bin/python -m pytest tests/integration -q; then
  log ERROR "Integration tests failed after push!"
  log INFO "Fix the failing tests and push again."
  exit 1
fi

log INFO "Post-push: integration tests passed âœ“"
log INFO "Ready for manual PR creation when needed: gh pr create --fill"
